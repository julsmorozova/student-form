function Student(t,e,n,r){function a(t){var e=document.createElement("td");return e.textContent=t,e}var s=this;this.data={name:t,date:e,age:n,rate:r},this.render=function(t){var e=document.createElement("tr");e.appendChild(a(t+1));for(var n in this.data)e.appendChild(a(this.data[n]));var r=a(),d=document.createElement("button");d.textContent="Delete",d.addEventListener("click",function(){studentList.splice(studentList.indexOf(s),1),renderList(studentList),setStudentsToStorage(studentList)}),r.appendChild(d);var o=document.createElement("button");return o.textContent="Edit",o.addEventListener("click",function(){fillForm(studentList.indexOf(s))}),r.appendChild(o),e.appendChild(r),e}}function addStudent(){var t=new Student(formElements.name.value,formElements.date.value,formElements.age.value,formElements.rate.value);studentList.push(t),renderList(studentList),studentForm.reset(),setStudentsToStorage(studentList)}function editStudent(t){-1!==editIndex&&(studentList[editIndex].data.name=formElements.name.value,studentList[editIndex].data.date=formElements.date.value,studentList[editIndex].data.age=formElements.age.value,studentList[editIndex].data.rate=formElements.rate.value,renderList(studentList),studentForm.reset(),setStudentsToStorage(studentList),editIndex=-1),saveButton.disabled=!1,saveChangesButton.disabled=!0}function fillForm(t){editIndex=t,formElements.name.value=studentList[t].data.name,formElements.date.value=studentList[t].data.date,formElements.age.value=studentList[t].data.age,formElements.rate.value=studentList[t].data.rate,saveButton.disabled=!0,saveChangesButton.disabled=!1}function renderList(t){studentTbody.innerHTML="",t.forEach(function(t,e){studentTbody.appendChild(t.render(e))})}function filterByUserParams(t){var e=["age","rate","name","date"];return e.every(function(e){switch(e){case"age":if(filterFormElements.age.value&&t.data.age<filterFormElements.age.value)return!1;break;case"rate":if(filterFormElements.rate.value&&t.data.rate<filterFormElements.rate.value)return!1;break;case"date":if(filterFormElements.date.value&&t.data.date!==filterFormElements.date.value)return!1;case"name":if(filterFormElements.name.value&&-1===t.data.name.indexOf(filterFormElements.name.value))return!1}return!0})}function getStudentsFromStorage(){var t=localStorage.getItem("studentList"),e=[];return t&&JSON.parse(t).forEach(function(t){var n=new Student;n.data=t.data,e.push(n)}),e}function setStudentsToStorage(t){localStorage.setItem("studentList",JSON.stringify(t))}function FormValidator(form){"use strict";this.fields=[],this.parseRules=function(){for(var i=0,ln=form.elements.length;ln>i;i++)if(form.elements[i].dataset.validate){var parentEl=form.elements[i].parentNode,errorEl=document.createElement("div");errorEl.classList.add("error-text"),parentEl.appendChild(errorEl),this.fields.push({element:form.elements[i],parentEl:parentEl,errorEl:errorEl,rules:eval("({"+form.elements[i].dataset.validate+"})")})}},this.validate=function(t){var e=!0,n=this;return this.fields.forEach(function(r){var a=r.element.value;if(""!==a||t===!0){var s=!0;r.errorEl.textContent="";for(var d in r.rules){var o=n[d](a,r.rules[d]);if("string"==typeof o){e=!1,s=!1,r.errorEl.textContent=o;break}}s?r.parentEl.classList.remove("error"):r.parentEl.classList.add("error")}}),e},this.notEmpty=function(t){return t?!0:"Requried field."},this.text=function(t){return/^\D+$/.test(t)?!0:"Should contain only letters."},this.number=function(t){return/^\d+$/.test(t)?!0:"Should contain only numbers."},this.max=function(t,e){return t>e?"Should be less than or equal to "+e+".":!0},this.min=function(t,e){return e>t?"Should be more than or equal to "+e+".":t>=e},this.date=function(t){return Date.parse(t)?!0:"Should use yyyy-mm-dd date format."},this.parseRules()}function sortByField(t,e,n,r){return function(t,a){var s=0,t=t.data[e],a=a.data[e];return"string"===n?(t=t.toLowerCase(),a=a.toLowerCase()):"number"===n&&(t=Number(t),a=Number(a)),a>t?s=-1:t>a&&(s=1),r&&(s=-1*s),s}}function setSortEvent(t,e){t.addEventListener("click",function(t){t.preventDefault();var n=studentList.slice(0);n=n.sort(sortByField(n,e.field,e.type,e.desc)),renderList(n),enableUndoSortButton(e.field)})}function enableUndoSortButton(t){for(var e=0,n=sortCancelButton.length;n>e;e++)sortCancelButton[e].disabled=sortCancelButton[e].dataset.field!==t}function sortCancel(){renderList(studentList),enableUndoSortButton()}var studentList=[],studentForm=document.querySelector("#student-form"),formElements=studentForm.elements,studentTbody=document.querySelector("#students-tbody"),saveChangesButton=document.querySelector(".save-changes"),saveButton=document.querySelector(".main.save"),sortCancelButton=document.getElementsByClassName("sort-cancel"),editIndex=-1,filterForm=document.querySelector("#filter"),filterFormElements=filterForm.elements,sortButtons=document.querySelectorAll("[data-sort]"),cancelFilterButton=document.querySelector(".cancel-filter"),studentValidator=new FormValidator(studentForm),studentList=getStudentsFromStorage();filterForm.addEventListener("submit",function(t){t.preventDefault(),renderList(studentList.filter(filterByUserParams))}),cancelFilterButton.addEventListener("click",function(){filterForm.reset(),renderList(studentList)}),studentForm.addEventListener("submit",function(t){t.preventDefault(),studentValidator.validate(!0)&&addStudent()}),studentForm.addEventListener("change",function(){studentValidator.validate(!1)}),saveChangesButton.addEventListener("click",editStudent);for(var i=0,ln=sortCancelButton.length;ln>i;i++)sortCancelButton[i].addEventListener("click",sortCancel);for(var i=0,ln=sortButtons.length;ln>i;i++){var sortParams=eval("({"+sortButtons[i].dataset.sort+"})");setSortEvent(sortButtons[i],sortParams)}renderList(studentList);